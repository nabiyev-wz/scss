<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <link rel="stylesheet" href="./scss/main.css">
    <!-- Firebase SDKlarini ulash -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>

<body>
    <div class="container">
        <!-- Login form -->
        <div class="login-form" id="loginForm">
            <h2>What's your phone number?</h2>
            <div class="phone-input">
                <div class="country-select">
                    <img src="https://flagcdn.com/uz.svg" alt="Uzbekistan flag" class="flag">
                    <span>+998</span>
                </div>
                <input type="tel" id="phone" placeholder="90 123 45 67" maxlength="9">
            </div>

            <div id="recaptcha-container"></div>
            <button class="continue-btn" id="continueBtn">Continue</button>

            <div class="divider">
                <span>or</span>
            </div>

            <button class="social-btn google">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google">
                Continue with Google
            </button>

            <button class="social-btn apple">
                <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg" alt="Apple">
                Continue with Apple
            </button>

            <button class="social-btn facebook">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg"
                    alt="Facebook">
                Continue with Facebook
            </button>

            <p class="terms">
                By proceeding, you consent to get calls, WhatsApp or SMS messages, including by automated means.
            </p>
        </div>

        <!-- Verification screen -->
        <div class="verification-screen" id="verificationScreen" style="display: none;">
            <button class="back-btn" id="backBtn">&larr;</button>
            <h2>Enter the 4-digit code sent to you at <span id="entered-phone"></span></h2>
            <div class="code-inputs">
                <input type="text" maxlength="1" class="code-input">
                <input type="text" maxlength="1" class="code-input">
                <input type="text" maxlength="1" class="code-input">
                <input type="text" maxlength="1" class="code-input">
            </div>
            <p class="resend-code">I haven't received a code (<span id="timer">1:00</span>)</p>
            <button class="next-btn" id="verifyBtn" disabled>Next</button>
        </div>
    </div>

    <script>
        // Firebase konfiguratsiyasi
        const firebaseConfig = {
            // Firebase console dan olingan ma'lumotlarni kiriting
            apiKey: "AIzaSyCze_pkghzOEgxifR8sWajOUZi5ZL9m6kk",
            authDomain: "mobil-aef97.firebaseapp.com",
            projectId: "mobil-aef97",
            storageBucket: "mobil-aef97.firebasestorage.app",
            messagingSenderId: "385204631584",
            appId: "1:385204631584:web:bcb8159fef177480da2445",
            measurementId: "G-HB9BWJDPSN"
        };

        // Firebase ni ishga tushirish
        firebase.initializeApp(firebaseConfig);

        let verificationId = '';
        const auth = firebase.auth();

        // ReCaptcha ni sozlash
        window.onload = function () {
            render();
        };

        function render() {
            window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                'size': 'invisible'
            });
            recaptchaVerifier.render();
        }

        // Continue tugmasi bosilganda
        document.getElementById('continueBtn').addEventListener('click', function () {
            const phoneNumber = '+998' + document.getElementById('phone').value;
            const appVerifier = window.recaptchaVerifier;

            auth.signInWithPhoneNumber(phoneNumber, appVerifier)
                .then(function (confirmationResult) {
                    window.confirmationResult = confirmationResult;
                    verificationId = confirmationResult.verificationId;

                    // Verification ekraniga o'tish
                    document.getElementById('loginForm').style.display = 'none';
                    document.getElementById('verificationScreen').style.display = 'block';
                    document.getElementById('entered-phone').textContent = phoneNumber;
                    startTimer();
                })
                .catch(function (error) {
                    alert(error.message);
                });
        });

        // Orqaga qaytish
        document.getElementById('backBtn').addEventListener('click', function () {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('verificationScreen').style.display = 'none';
        });

        // Kod kiritish maydonlari uchun
        const codeInputs = document.querySelectorAll('.code-input');
        codeInputs.forEach((input, index) => {
            input.addEventListener('input', function (e) {
                if (this.value.length === 1) {
                    if (index < codeInputs.length - 1) {
                        codeInputs[index + 1].focus();
                    }
                }

                // Barcha maydonlar to'ldirilganligini tekshirish
                let isComplete = true;
                let code = '';
                codeInputs.forEach(input => {
                    if (!input.value) {
                        isComplete = false;
                    }
                    code += input.value;
                });

                document.getElementById('verifyBtn').disabled = !isComplete;

                if (isComplete) {
                    verifyCode(code);
                }
            });

            // Backspace bosilganda
            input.addEventListener('keydown', function (e) {
                if (e.key === 'Backspace' && !this.value && index > 0) {
                    codeInputs[index - 1].focus();
                }
            });
        });

        // Kodni tekshirish
        function verifyCode(code) {
            confirmationResult.confirm(code)
                .then(function (result) {
                    // Muvaffaqiyatli kirish
                    alert('Successfully logged in!');
                })
                .catch(function (error) {
                    // Xatolik yuz berdi
                    alert('Invalid code');
                });
        }

        // Timer
        function startTimer() {
            let timeLeft = 60;
            const timerDisplay = document.getElementById('timer');

            const timer = setInterval(function () {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timerDisplay.parentElement.innerHTML = 'Code expired. Please try again.';
                }
                timeLeft--;
            }, 1000);
        }
    </script>
</body>

</html>